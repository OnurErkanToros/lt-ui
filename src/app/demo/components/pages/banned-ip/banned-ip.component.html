<p-toast />
<div class="progress-spinner" *ngIf="loading$ | async">
    <p-progressSpinner
        styleClass="w-4rem h-4rem "
        strokeWidth="7"
        animationDuration=".5s"
    >
    </p-progressSpinner>
</div>
<p-toolbar styleClass="mb-4 gap-2">
    <ng-template pTemplate="left">
        <p-button
            pRipple
            severity="info"
            label="Veritabanı ve Dosyayı Eşitle"
            (click)="syncDbAndFile()"
        />
    </ng-template>

    <ng-template pTemplate="right">
        <p-button
            pRipple
            severity="warning"
            label="Seçili Olanların Banı Kaldır"
            [disabled]="!selectedBannedIpList || !selectedBannedIpList.length"
            (click)="setUnbanIPList()"
        />
    </ng-template>
</p-toolbar>

<p-card header="Ban Yönetimi">
    <p-table
        #dt
        [value]="bannedIpList"
        [tableStyle]="{ 'min-width': '75rem' }"
        [rowHover]="true"
        dataKey="id"
        [selectionMode]="'multiple'"
        [(selection)]="selectedBannedIpList"
    >
        <ng-template pTemplate="caption">
            <form [formGroup]="searchFormGroup" (ngSubmit)="searchFormSubmit()">
                <div class="flex align-items-center justify-content-between">
                    <h5 class="m-0">Banlanmışlar listesi</h5>

                    <span class="p-input-icon-left ml-auto">
                        <i class="pi pi-search"></i>
                        <input
                            pInputText
                            type="text"
                            formControlName="ip"
                            placeholder="IP girebilirsiniz"
                        />
                    </span>

                    <p-selectButton
                        [options]="ipTypeOptions"
                        formControlName="ipType"
                        [multiple]="false"
                        optionLabel="name"
                        optionValue="value"
                        class="ml-2"
                    />

                    <p-button type="submit" class="ml-2">Ara</p-button>
                </div>
            </form>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th style="width: 4rem">
                    <p-tableHeaderCheckbox />
                </th>
                <th>ID</th>
                <th>IP</th>
                <th>IP Tipi</th>
                <th>Listeye Eklenme Zamanı</th>
                <th>Listeye Ekleyen</th>
                <th></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-bannedIp>
            <tr>
                <td>
                    <p-tableCheckbox [value]="bannedIp" />
                </td>
                <td>
                    {{ bannedIp.id }}
                </td>
                <td>
                    {{ bannedIp.ip }}
                </td>
                <td>
                    {{ bannedIp.ipType }}
                </td>
                <td>
                    {{ bannedIp.createdAt | date : "dd MMMM yyyy, EEEE HH:mm" }}
                </td>
                <td>
                    {{ bannedIp.createdBy }}
                </td>
                <td>
                    <p-button
                        pRipple
                        label="Ban kaldır"
                        icon="pi pi-trash"
                        severity="danger"
                        [rounded]="true"
                        [outlined]="true"
                        disable="true"
                        (click)="setUnbanSingleIp(bannedIp)"
                    />
                </td>
            </tr>
        </ng-template>
    </p-table>
    <p-paginator
        (onPageChange)="onPageChange($event)"
        [first]="first"
        [rows]="size"
        [totalRecords]="totalRecords"
        [showCurrentPageReport]="true"
        [showJumpToPageDropdown]="false"
        [rowsPerPageOptions]="[10, 25, 50]"
        currentPageReportTemplate="{totalRecords} kaydın {first} ile {last} arası gösteriliyor."
    />
</p-card>
