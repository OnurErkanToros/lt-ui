<p-toolbar styleClass="mb-4 gap-2">
    <ng-template pTemplate="left"> </ng-template>
    <ng-template pTemplate="right">
        <p-button
            pRipple
            severity="warning"
            label="Banla"
            icon="pi pi-plus"
            (click)="setBanSuspectIp()"
            [disabled]="selectedSuspectIpList.length === 0"
        />
    </ng-template>
</p-toolbar>

<p-table
    #dt
    [value]="suspectIpList"
    [tableStyle]="{ 'min-width': '75rem' }"
    [rowHover]="true"
    dataKey="id"
    currentPageReportTemplate="{totalRecords} kayıttan {first} - {last} arası gösteriliyor"
    [showCurrentPageReport]="true"
    [(selection)]="selectedSuspectIpList"
>
    <ng-template pTemplate="caption">
        <form [formGroup]="searchFormGroup" (ngSubmit)="searchSubmit()">
            <div class="flex align-items-center justify-content-between">
                <h5 class="m-0">Log Dinleyicinin Yakaladığı IP Adresleri</h5>

                <span class="p-input-icon-left ml-auto">
                    <i class="pi pi-search"></i>
                    <input
                        pInputText
                        type="text"
                        formControlName="ip"
                        placeholder="IP girebilirsiniz"
                    />
                </span>

                <span class="p-input-icon-left ml-2">
                    <i class="pi pi-search"></i>
                    <input
                        pInputText
                        type="text"
                        formControlName="host"
                        placeholder="Host girebilirsiniz"
                    />
                </span>

                <p-selectButton
                    [options]="statusOptions"
                    formControlName="status"
                    [multiple]="false"
                    optionLabel="name"
                    optionValue="value"
                    class="ml-2"
                />

                <p-button type="submit" class="ml-2">Ara</p-button>
            </div>
        </form>
    </ng-template>
    <ng-template pTemplate="header">
        <tr>
            <th style="width: 4rem">
                
            </th>
            <th>IP Adresi</th>
            <th>Hangi hosttan gelmiş</th>
            <th>Oluşturulma Tarihi</th>
            <th>Durum</th>
            <th>Durum Güncellenme</th>
            <th>Durum Güncelleyen</th>
            <th></th>
        </tr>
    </ng-template>
    <ng-template pTemplate="body" let-suspect>
        <tr>
            <td>
                <p-tableCheckbox [value]="suspect" [disabled]="!isRowSelectable(suspect)"/>
            </td>
            <td>
                {{ suspect.ip }}
            </td>
            <td>
                {{ suspect.host }}
            </td>
            <td>
                {{ suspect.createdAt | date : "dd MMMM yyyy, EEEE HH:mm" }}
            </td>
            <td>
                {{ suspect.status }}
            </td>
            <td>
                {{ suspect.statusAt | date : "dd MMMM yyyy, EEEE HH:mm" }}
            </td>
            <td>
                {{ suspect.statusBy }}
            </td>
            <td>
                <p-button
                    severity="help"
                    label="Detay"
                    icon="pi pi-info-circle"
                    class="mr-2"
                    (click)="showLineDetailDialog(suspect)"
                />
                <p-button
                    severity="info"
                    label="Abuse Sorgulaması"
                    icon="pi pi-search"
                    class="mr-2"
                    (click)="checkIpAddress(suspect.ip)"
                />
            </td>
        </tr>
    </ng-template>
</p-table>
<p-paginator
        (onPageChange)="onPageChange($event)"
        [first]="first"
        [rows]="size"
        [totalRecords]="totalRecords"
        [showCurrentPageReport]="true"
        [showJumpToPageDropdown]="false"
        [rowsPerPageOptions]="[10, 25, 50]"
        currentPageReportTemplate="{totalRecords} kaydın {first} ile {last} arası gösteriliyor."
    />

<p-dialog
  header="{{ selectedSuspectIp.ip }} Detayı"
  [modal]="true"
  [(visible)]="visibleDetail"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
  class="ip-detail-dialog"
>
  <div class="ip-detail-content">
    <ul class="ip-detail-list">
      <li>
        <span class="ip-detail-label">Hangi hosttan geldi?</span>
        <span class="ip-detail-value">{{ selectedSuspectIp.host }}</span>
      </li>
      <li>
        <span class="ip-detail-label">Ne zaman geldi?</span>
        <span class="ip-detail-value">
          {{ selectedSuspectIp.createdAt | date: "dd MMMM yyyy, EEEE HH:mm" }}
        </span>
      </li>
      <li>
        <span class="ip-detail-label">Satır detayı</span>
        <span class="ip-detail-value">{{ selectedSuspectIp.line }}</span>
      </li>
      <li>
        <span class="ip-detail-label">Regex</span>
        <span class="ip-detail-value">{{ selectedSuspectIp.pattern }}</span>
      </li>
      <li>
        <span class="ip-detail-label">Durumu</span>
        <span class="ip-detail-value">{{ selectedSuspectIp.status }}</span>
      </li>
      <li>
        <span class="ip-detail-label">Durum değişiklik zamanı</span>
        <span class="ip-detail-value">{{ selectedSuspectIp.statusAt }}</span>
      </li>
      <li>
        <span class="ip-detail-label">Durum değiştiren</span>
        <span class="ip-detail-value">{{ selectedSuspectIp.statusBy }}</span>
      </li>
    </ul>
  </div>
</p-dialog>



<p-dialog
    header="{{ abuseCheckResponse.ipAddress }} Bilgileri"
    [modal]="true"
    [(visible)]="visibleAbuseDetail"
    draggable="false"
    maximizable="true"
    class="ip-info-dialog"
>
    <div class="ip-dialog-content">
        <div class="ip-info-row">
            <label><strong>IP Adresi:</strong></label>
            <span>{{ abuseCheckResponse.ipAddress }}</span>
        </div>
        <div class="ip-info-row">
            <label><strong>IP Versiyon:</strong></label>
            <span>{{ abuseCheckResponse.ipVersion }}</span>
        </div>
        <div class="ip-info-row">
            <label><strong>İnternet Sağlayıcı:</strong></label>
            <span>{{ abuseCheckResponse.isp }}</span>
        </div>
        <div class="ip-info-row">
            <label><strong>Ülke:</strong></label>
            <span>{{
                getCountryNameByCountryCode(abuseCheckResponse.countryCode)
            }}</span>
        </div>
        <div class="ip-info-row">
            <label><strong>Toplam Raporlama Sayısı:</strong></label>
            <span>{{ abuseCheckResponse.totalReports }}</span>
        </div>
        <div class="ip-info-row">
            <label><strong>Kaç Farklı Kişi Raporladı:</strong></label>
            <span>{{ abuseCheckResponse.numDistinctUsers }}</span>
        </div>
        <div class="ip-info-row">
            <label><strong>Abuse Risk Puanı:</strong></label>
            <span>{{ abuseCheckResponse.abuseConfidenceScore }}</span>
        </div>
        <div class="ip-info-row">
            <label><strong>Domain:</strong></label>
            <span>{{ abuseCheckResponse.domain }}</span>
        </div>
        <div class="ip-info-row">
            <label><strong>Public mi?:</strong></label>
            <span>{{ abuseCheckResponse.isPublic ? "Evet" : "Hayır" }}</span>
        </div>
        <div class="ip-info-row">
            <label><strong>Tor mu?:</strong></label>
            <span>{{ abuseCheckResponse.isTor ? "Evet" : "Hayır" }}</span>
        </div>
        <div class="ip-info-row">
            <label><strong>Abuse Beyaz Listesinde mi?:</strong></label>
            <span>{{
                abuseCheckResponse.isWhitelisted ? "Evet" : "Hayır"
            }}</span>
        </div>
    </div>
</p-dialog>
